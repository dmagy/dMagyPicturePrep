{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "dMagy Photo Metadata Standard (dMPMS)",
  "description": "Schema for .dmpms.json metadata sidecar files",
  "type": "object",

  "required": ["dmpms_version", "source_file"],

  "properties": {
    "dmpms_version": {
      "type": "string",
      "pattern": "^[0-9]+\\.[0-9]+(\\.[0-9]+)?$",
      "description": "Version of the dMPMS schema used."
    },

    "source_file": {
      "type": "string",
      "description": "Filename of the associated image."
    },

    "title": {
      "type": "string",
      "description": "Human-readable title for display."
    },

    "description": {
      "type": "string",
      "description": "Long-form description of the image."
    },

    "tags": {
      "type": "array",
      "items": { "type": "string" },
      "description": "Keyword tags used for organization and filtering."
    },

    "people": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "name": { "type": "string" }
        },
        "required": ["name"],
        "additionalProperties": false
      },
      "description": "List of people associated with the image."
    },

    "date_taken": {
      "description": "Exact or approximate date the image content occurred.",
      "type": "string",
      "pattern": "^([0-9]{4}(-[0-9]{2}){0,2}(T[0-9]{2}:[0-9]{2}:[0-9]{2}([+-][0-9]{2}:[0-9]{2})?)?|[0-9]{4}s)$"
    }

,

    "virtual_crops": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["id", "label", "aspect_ratio", "rect"],
        "properties": {
          "id": {
            "type": "string",
            "description": "Unique identifier for this crop."
          },
          "label": {
            "type": "string",
            "description": "Display-friendly name for this crop."
          },
          "aspect_ratio": {
            "type": "string",
            "pattern": "^[0-9]+:[0-9]+$",
            "description": "Aspect ratio expressed as W:H."
          },
          "rect": {
            "type": "object",
            "required": ["x", "y", "width", "height"],
            "properties": {
              "x": { "type": "number", "minimum": 0, "maximum": 1 },
              "y": { "type": "number", "minimum": 0, "maximum": 1 },
              "width": { "type": "number", "minimum": 0, "maximum": 1 },
              "height": { "type": "number", "minimum": 0, "maximum": 1 }
            },
            "additionalProperties": false
          }
        },
        "additionalProperties": false
      },
      "description": "List of virtual crop definitions."
    },

    "history": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["action", "timestamp"],
        "properties": {
          "action": { "type": "string" },
          "timestamp": { "type": "string", "format": "date-time" },
          "old_name": { "type": "string" },
          "new_name": { "type": "string" },
          "crop_id": { "type": "string" }
        },
        "additionalProperties": true
      },
      "description": "Append-only log of meaningful changes."
    }
  },

  "additionalProperties": true
}

